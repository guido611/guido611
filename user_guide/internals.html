

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Altair Internals: Understanding the Library &mdash; sphinx-test 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="API.html" />
    <link rel="prev" title="Altair Renderers" href="renderers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> sphinx-test
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/starting.html">Basic Statistical Visualization</a></li>
</ul>
<p class="caption"><span class="caption-text">Gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">Example Gallery</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">Specifying Data in Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="encoding.html">Encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="marks.html">Marks</a></li>
<li class="toctree-l1"><a class="reference internal" href="transform.html">Data Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="interactions.html">Bindings, Selections, Conditions: Making Charts Interactive</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Top-Level Chart Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="compound_charts.html">Compound Charts: Layer, HConcat, VConcat, Repeat, Facet</a></li>
<li class="toctree-l1"><a class="reference internal" href="saving_charts.html">Saving Altair Charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="customization.html">Customizing Visualizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="times_and_dates.html">Times and Dates in Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Display Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="renderers.html">Altair Renderers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Altair Internals: Understanding the Library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#altair-chart-to-vega-lite-spec">Altair chart to Vega-Lite Spec</a></li>
<li class="toctree-l2"><a class="reference internal" href="#altair-s-low-level-object-structure">Altair’s Low-Level Object Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#converting-vega-lite-to-altair">Converting Vega-Lite to Altair</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecosystem.html">Altair Ecosystem</a></li>
</ul>
<p class="caption"><span class="caption-text">Case Studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../case_studies/exploring-weather.html">Exploring Seattle Weather</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="importing.html">Importing Vega &amp; Vega-Lite Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="display_frontends.html">Displaying Charts in Various Frontends</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_renderers.html">Customizing Renderers</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_transformers.html">Data transformers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sphinx-test</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Altair Internals: Understanding the Library</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user_guide/internals.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="altair-internals-understanding-the-library">
<span id="user-guide-internals"></span><h1>Altair Internals: Understanding the Library<a class="headerlink" href="#altair-internals-understanding-the-library" title="Permalink to this headline">¶</a></h1>
<p>This section will provide some details about how the Altair API relates to the
Vega-Lite visualization specification, and how you can use that knowledge to
use the package more effectively.</p>
<p>First of all, it is important to realize that when stripped down to its core,
Altair itself cannot render visualizations. Altair is an API that does one
very well-defined thing:</p>
<ul class="simple">
<li><p><strong>Altair provides a Python API for generating validated Vega-Lite specifications</strong></p></li>
</ul>
<p>That’s it. In order to take those specifications and turn them into actual
visualizations requires a frontend that is correctly set up, but strictly
speaking that rendering is generally not controlled by the Altair package.</p>
<div class="section" id="altair-chart-to-vega-lite-spec">
<h2>Altair chart to Vega-Lite Spec<a class="headerlink" href="#altair-chart-to-vega-lite-spec" title="Permalink to this headline">¶</a></h2>
<p>Since Altair is fundamentally about constructing chart specifications, the central
functionality of any chart object are the <code class="xref py py-meth docutils literal notranslate"><span class="pre">to_dict()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">to_json()</span></code> methods, which output the chart specification as a Python
dict or JSON string, respectively. For example, here is a simple scatter chart,
from which we can output the JSON representation:</p>
<p>Before returning the dict or JSON output, Altair validates it against the
<a class="reference external" href="https://github.com/vega/schema">Vega-Lite schema</a> using the
<a class="reference external" href="https://python-jsonschema.readthedocs.io/en/latest/">jsonschema</a> package.
The Vega-Lite schema defines valid attributes and values that can appear
within the specification of a Vega-Lite chart.</p>
<p>With the JSON schema in hand, it can then be passed to a library such as
<a class="reference external" href="https://github.com/vega/vega-embed">Vega-Embed</a> that knows how to read the
specification and render the chart that it describes, and the result is the
following visualization:</p>
<p>Whenever you use Altair within JupyterLab, Jupyter notebook, or other frontends,
it is frontend extensions that extract the JSON output from the Altair chart
object and pass that specification along to the appropriate rendering code.</p>
</div>
<div class="section" id="altair-s-low-level-object-structure">
<h2>Altair’s Low-Level Object Structure<a class="headerlink" href="#altair-s-low-level-object-structure" title="Permalink to this headline">¶</a></h2>
<p>The standard API methods used in Altair (e.g. <code class="xref py py-meth docutils literal notranslate"><span class="pre">mark_point()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">encode()</span></code>, <code class="docutils literal notranslate"><span class="pre">configure_*()</span></code>, <code class="docutils literal notranslate"><span class="pre">transform_*()</span></code>, etc.)
are higher-level convenience functions that wrap the low-level API.
That low-level API is essentially a Python object hierarchy that mirrors
that of the JSON schema definition.</p>
<p>For example, we can choose to avoid the convenience methods and rather construct
the above chart using these low-level object types directly:</p>
<p>This low-level approach is much more verbose than the typical idiomatic approach
to creating Altair charts, but it makes much more clear the mapping between
Altair’s python object structure and Vega-Lite’s schema definition structure.</p>
<p>One of the nice features of Altair is that this low-level object hierarchy is not
constructed by hand, but rather <em>programmatically generated</em> from the Vega-Lite
schema, using the <code class="docutils literal notranslate"><span class="pre">generate_schema_wrapper.py</span></code> script that you can find in
<a class="reference external" href="https://github.com/altair-viz/altair/blob/master/tools/generate_schema_wrapper.py">Altair’s repository</a>.
This auto-generation of code propagates descriptions from the vega-lite schema
into the Python class docstrings, from which the
<a class="reference external" href="http://altair-viz.github.io/user_guide/API.html">API Reference</a>
within Altair’s documentation are in turn automatically generated.
This means that as the Vega-Lite schema evolves, Altair can very quickly be brought
up-to-date, and only the higher-level chart methods need to be updated by hand.</p>
</div>
<div class="section" id="converting-vega-lite-to-altair">
<h2>Converting Vega-Lite to Altair<a class="headerlink" href="#converting-vega-lite-to-altair" title="Permalink to this headline">¶</a></h2>
<p>With this knowledge in mind, and with a bit of practice, it is fairly
straightforward to construct an Altair chart from a Vega-Lite spec.
For example, consider the
<a class="reference external" href="https://vega.github.io/vega-lite/examples/bar.html">Simple Bar Chart</a> example
from the Vega-Lite documentation, which has the following JSON specification:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;https://vega.github.io/schema/vega-lite/v2.json&quot;</span><span class="p">,</span>
  <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;A simple bar chart with embedded data.&quot;</span><span class="p">,</span>
  <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">28</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">55</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">43</span><span class="p">},</span>
      <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">91</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">81</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">53</span><span class="p">},</span>
      <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">87</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">52</span><span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;mark&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span>
  <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ordinal&quot;</span><span class="p">},</span>
    <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;quantitative&quot;</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>At the lowest level, we can use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">from_json()</span></code> class method to
construct an Altair chart object from this string of Vega-Lite JSON:</p>
<p>Likewise, if you have the Python dictionary equivalent of the JSON string,
you can use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">from_dict()</span></code> method to construct the chart object:</p>
<p>With a bit more effort and some judicious copying and pasting, we can
manually convert this into more idiomatic Altair code for the same chart,
including constructing a Pandas dataframe from the data values:</p>
<p>The key is to realize that <code class="docutils literal notranslate"><span class="pre">&quot;encoding&quot;</span></code> properties are usually set using the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">encode()</span></code> method, encoding types are usually computed from
short-hand type codes, <code class="docutils literal notranslate"><span class="pre">&quot;transform&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;config&quot;</span></code> properties come from
the <code class="docutils literal notranslate"><span class="pre">transform_*()</span></code> and <code class="docutils literal notranslate"><span class="pre">configure_*()</span></code> methods, and so on.</p>
<p>This approach is the process by which Altair contributors constructed many
of the initial examples in the
<a class="reference external" href="https://altair-viz.github.io/gallery/index.html">Altair Example Gallery</a>,
drawing inspiration from the
<a class="reference external" href="https://vega.github.io/vega-lite/examples/">Vega-Lite Example Gallery</a>.
Becoming familiar with the mapping between Altair and Vega-Lite at this level
is useful in making use of the Vega-Lite documentation in places where Altair’s
documentation is weak or incomplete.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="API.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="renderers.html" class="btn btn-neutral float-left" title="Altair Renderers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Guido Drechsel

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>